pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

local player_lane = 1
local spot = 128/3-16
local bads = {}
local bad_count = 0
local max_speed = 4

function pl()
	if player_lane == 1 then
		player_lane = 1
	elseif player_lane == 2 then
		player_lane = 1
	elseif player_lane == 3 then
		player_lane = 2
	end
end

function pr()
	if player_lane == 3 then
		player_lane = 3
	elseif player_lane == 2 then
		player_lane = 3
	elseif player_lane == 1 then
		player_lane = 2
	end
end

function _init()
end

function make_bad()
	return { spot = flr(rnd(3)+1),y=0, 
		speed=1+flr(rnd(max_speed))}
end

function update_bads()
	if bad_count<3 then
		add(bads,make_bad())
		bad_count += 1
	end
	for i=1,#bads do
		local b = bads[i]
		b.y+=b.speed
		if b.y>128 then
			b.y = 0
			b.spot=flr(rnd(3)+1)
			b.speed = flr(rnd(max_speed)+1)
		end
	end
end

function _update()
	if btnp(0) then
		-- left
		pl()
	end
	if btnp(1) then
		-- right
		pr()
	end
	update_bads()
end

function _draw()
	cls(0)
	line(spot+4,0,spot+4,128)
	line(spot*2+4,0,spot*2+4,128)
	line(spot*3+4,0,spot*3+4,128)

	if player_lane == 1 then
		spr(1,spot,100)
	elseif player_lane == 2 then
		spr(1,spot * 2, 100)
	elseif player_lane == 3 then
		spr(1,spot*3,100)
	end

	for i=1,#bads do
		local b = bads[i]
		spr(2,b.spot*spot,b.y)
	end
end


__gfx__
00000000007777008080080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777008080080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700007777008080080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000770008088880800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000007777008088880800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000770008088880800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777008088880800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077007708088880800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
